<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coffee Shop — Live Orders Dashboard</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small visual helpers */
    .card-status-waiting { --tw-bg-opacity: 1; background-color: rgba(250, 204, 21, 0.12); }
    .card-status-inprogress { --tw-bg-opacity: 1; background-color: rgba(59, 130, 246, 0.08); }
    .card-status-ready { --tw-bg-opacity: 1; background-color: rgba(34, 197, 94, 0.06); }
    .card-status-cancelled { --tw-bg-opacity: 1; background-color: rgba(239, 68, 68, 0.06); text-decoration: line-through; }
  </style>
</head>
<body class="antialiased bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto p-4">
    <header class="mb-4">
      <h1 class="text-2xl md:text-3xl font-bold">☕ Coffee Shop — Live Orders Dashboard</h1>
      <p class="text-sm text-gray-600">Manage orders, update statuses, see alerts, and let the Smart Assistant give recommendations.</p>
    </header>

    <!-- Controls Row -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div class="col-span-2 flex gap-2 items-center">
        <button id="addDemoBtn" class="px-3 py-2 bg-indigo-600 text-white rounded shadow-sm hover:bg-indigo-500">+ Add demo order</button>
        <button id="add5DemoBtn" class="px-3 py-2 bg-indigo-500 text-white rounded shadow-sm hover:bg-indigo-400">+ Add 5 demo orders</button>
        <button id="clearOrdersBtn" class="px-3 py-2 bg-red-600 text-white rounded shadow-sm hover:bg-red-500">Clear cancelled</button>

        <label class="ml-4 flex items-center gap-2 text-sm text-gray-700">
          Auto-refresh:
          <select id="refreshSelect" class="ml-2 rounded border-gray-300 text-sm">
            <option value="0">Off</option>
            <option value="5">5s</option>
            <option value="10">10s</option>
            <option value="30">30s</option>
            <option value="60">60s</option>
          </select>
        </label>

        <label class="ml-4 text-sm text-gray-700">Speed multiplier:
          <input id="speedRange" type="range" min="0.25" max="3" step="0.25" value="1" class="ml-2" />
        </label>
      </div>

      <div class="col-span-1 bg-white p-3 rounded shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xs text-gray-500">Local time</div>
            <div id="localTime" class="text-lg font-medium"></div>
          </div>
          <div class="text-right">
            <div class="text-xs text-gray-500">Today's revenue</div>
            <div id="todayRevenue" class="text-lg font-semibold">₹0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Summary Bar and Alerts -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
      <div class="lg:col-span-2 bg-white p-4 rounded shadow-sm">
        <div class="flex flex-wrap gap-4 items-center">
          <div class="p-3 rounded bg-gray-100">
            <div class="text-xs text-gray-500">Total orders</div>
            <div id="totalOrders" class="text-xl font-bold">0</div>
          </div>
          <div class="p-3 rounded bg-gray-100">
            <div class="text-xs text-gray-500">Ready</div>
            <div id="readyCount" class="text-xl font-bold">0</div>
          </div>
          <div class="p-3 rounded bg-gray-100">
            <div class="text-xs text-gray-500">Pending (waiting + in progress)</div>
            <div id="pendingCount" class="text-xl font-bold">0</div>
          </div>

          <div class="ml-auto text-sm text-gray-600">Smart Assistant:
            <span id="assistantText" class="font-medium ml-2">No suggestions yet</span>
          </div>
        </div>
      </div>

      <div class="bg-white p-4 rounded shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold">Alerts</div>
            <div class="text-xs text-gray-500">Long-waiting orders / large groups / cancellations</div>
          </div>
          <div class="text-sm text-gray-700">Active: <span id="alertCount">0</span></div>
        </div>

        <div id="alertsPanel" class="mt-3 space-y-2 max-h-48 overflow-auto"></div>
      </div>
    </section>

    <!-- Orders Grid -->
    <main>
      <div id="ordersGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </main>

    <footer class="mt-6 text-xs text-gray-500">Demo app — single file. Data is ephemeral and stored in-memory for this session.</footer>
  </div>

  <script>
    // ----- Demo Data and Utilities -----
    const DRINKS = ['Espresso', 'Americano', 'Cappuccino', 'Latte', 'Flat White', 'Mocha', 'Iced Coffee', 'Cold Brew', 'Chai Latte'];
    const PASTRIES = ['Croissant', 'Blueberry Muffin', 'Almond Biscotti', 'Pain au Chocolat', 'Scone'];
    const SNACKS = ['Bagel', 'Sandwich', 'Granola Bar', 'Yogurt Parfait'];
    const PAYMENT_METHODS = ['Cash', 'Card', 'UPI'];

    let orders = [];
    let nextOrderId = 1001;
    let refreshTimer = null;
    let lastTick = Date.now();

    // Helpers
    function nowISO(){ return new Date().toISOString(); }
    function formatTime(ts){ const d=new Date(ts); return d.toLocaleTimeString(); }
    function currency(num){ return '₹' + Number(num).toFixed(2); }

    function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function randomOrder(){
      const items = [];
      const drinkCount = 1 + Math.floor(Math.random()*3);
      for(let i=0;i<drinkCount;i++) items.push({type:'Drink', name: randomFrom(DRINKS), qty: 1 + Math.floor(Math.random()*2), price: 80 + Math.floor(Math.random()*120)});
      if(Math.random() < 0.6) items.push({type:'Pastry', name: randomFrom(PASTRIES), qty:1, price: 60 + Math.floor(Math.random()*80)});
      if(Math.random() < 0.4) items.push({type:'Snack', name: randomFrom(SNACKS), qty:1, price: 50 + Math.floor(Math.random()*50)});
      const amount = items.reduce((s,i)=>s + (i.price*i.qty),0);
      const custNames = ['Anita', 'Ravi', 'Priya', 'Sameer', 'Isha', 'Karan', 'Meera', 'Pratik', 'Sonal', 'Nikhil'];
      return {
        id: nextOrderId++,
        customer: randomFrom(custNames) + (Math.random()<0.15 ? ' (VIP)' : ''),
        items,
        status: 'waiting', // waiting | in progress | ready | cancelled
        payment: randomFrom(PAYMENT_METHODS),
        amount,
        timestamp: Date.now()
      };
    }

    // ----- Rendering -----
    function render(){
      const grid = document.getElementById('ordersGrid');
      grid.innerHTML = '';
      orders.slice().reverse().forEach(order => {
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow-sm flex flex-col gap-2 ' +
          (order.status==='waiting' ? 'card-status-waiting' : order.status==='in progress' ? 'card-status-inprogress' : order.status==='ready' ? 'card-status-ready' : 'card-status-cancelled');

        const header = document.createElement('div');
        header.className = 'flex items-start justify-between gap-2';
        header.innerHTML = `
          <div>
            <div class="text-sm font-semibold">#${order.id} — ${escapeHtml(order.customer)}</div>
            <div class="text-xs text-gray-500">${formatTime(order.timestamp)}</div>
          </div>
          <div class="text-right">
            <div class="text-sm font-medium">${currency(order.amount)}</div>
            <div class="text-xs text-gray-500">${escapeHtml(order.payment)}</div>
          </div>
        `;
        card.appendChild(header);

        const itemsList = document.createElement('div');
        itemsList.className = 'text-sm text-gray-700';
        itemsList.innerHTML = order.items.map(it=>`<div>${it.qty}× ${escapeHtml(it.name)} <span class="text-xs text-gray-400">(${it.type})</span></div>`).join('');
        card.appendChild(itemsList);

        const statusRow = document.createElement('div');
        statusRow.className = 'flex items-center gap-2 mt-2';
        statusRow.innerHTML = `
          <div class="text-xs font-semibold px-2 py-1 rounded border">Status: <span id="status-${order.id}">${escapeHtml(order.status)}</span></div>
          <div class="text-xs text-gray-500">Items: ${order.items.length}</div>
          <div class="ml-auto text-xs text-gray-500">Since: ${timeAgo(order.timestamp)}</div>
        `;
        card.appendChild(statusRow);

        const actions = document.createElement('div');
        actions.className = 'flex gap-2 mt-3';

        const progressBtn = document.createElement('button');
        progressBtn.className = 'px-2 py-1 bg-amber-500 text-white rounded text-sm hover:opacity-90';
        progressBtn.innerText = 'Advance';
        progressBtn.onclick = () => { advanceOrder(order.id, true); };

        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'px-2 py-1 bg-red-500 text-white rounded text-sm hover:opacity-90';
        cancelBtn.innerText = 'Cancel';
        cancelBtn.onclick = () => { cancelOrder(order.id); };

        const markReadyBtn = document.createElement('button');
        markReadyBtn.className = 'px-2 py-1 bg-green-600 text-white rounded text-sm hover:opacity-90';
        markReadyBtn.innerText = 'Mark Ready';
        markReadyBtn.onclick = () => { updateOrderStatus(order.id, 'ready'); };

        actions.appendChild(progressBtn);
        actions.appendChild(markReadyBtn);
        actions.appendChild(cancelBtn);

        card.appendChild(actions);

        // small footer
        const footer = document.createElement('div');
        footer.className = 'text-xs text-gray-400 mt-2';
        footer.innerText = 'Order type: ' + (order.items.length > 4 ? 'Large group' : 'Regular');
        card.appendChild(footer);

        grid.appendChild(card);
      });

      updateSummaryAndAlerts();
    }

    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function timeAgo(ts){ const sec = Math.floor((Date.now()-ts)/1000); if(sec<60) return sec + 's'; if(sec<3600) return Math.floor(sec/60)+'m'; return Math.floor(sec/3600)+'h'; }

    // ----- Order Manipulation -----
    function addOrder(o){ orders.push(o); render(); }
    function addRandomOrder(){ addOrder(randomOrder()); }

    function advanceOrder(id, manual=false){
      const o = orders.find(x=>x.id===id);
      if(!o) return;
      if(o.status==='waiting') o.status='in progress';
      else if(o.status==='in progress') o.status='ready';
      else if(o.status==='ready') { /*stay*/ }
      render();
      if(!manual) console.log('auto-progressed', id);
    }
    function updateOrderStatus(id, status){ const o=orders.find(x=>x.id===id); if(!o) return; o.status=status; render(); }
    function cancelOrder(id){ const o=orders.find(x=>x.id===id); if(!o) return; o.status='cancelled'; render(); }

    function clearCancelled(){ orders = orders.filter(o=>o.status!=='cancelled'); render(); }

    // ----- Summary & Alerts -----
    function updateSummaryAndAlerts(){
      const total = orders.length;
      const ready = orders.filter(o=>o.status==='ready').length;
      const pending = orders.filter(o=>o.status==='waiting' || o.status==='in progress').length;
      const revenue = orders.filter(o=>o.status!=='cancelled').reduce((s,o)=>s+o.amount,0);

      document.getElementById('totalOrders').innerText = total;
      document.getElementById('readyCount').innerText = ready;
      document.getElementById('pendingCount').innerText = pending;
      document.getElementById('todayRevenue').innerText = currency(revenue);

      // Alerts
      const alerts = [];
      const now = Date.now();
      orders.forEach(o=>{
        const ageMin = (now - o.timestamp)/60000;
        if(o.status!=='ready' && o.status!=='cancelled' && ageMin > 10) alerts.push({type:'long-wait', order:o, text:`Order #${o.id} waiting ${Math.floor(ageMin)}m`});
        if(o.items.length >= 5) alerts.push({type:'large-group', order:o, text:`Large order #${o.id} — ${o.items.length} items`});
        if(o.status==='cancelled') alerts.push({type:'cancelled', order:o, text:`Cancelled #${o.id}`});
      });

      const panel = document.getElementById('alertsPanel');
      panel.innerHTML = '';
      alerts.slice(0,50).forEach(a=>{
        const el = document.createElement('div');
        el.className = 'p-2 rounded text-sm ' + (a.type==='long-wait' ? 'bg-amber-50 border-l-4 border-amber-400' : a.type==='large-group' ? 'bg-blue-50 border-l-4 border-blue-400' : 'bg-red-50 border-l-4 border-red-400');
        el.innerText = a.text;
        panel.appendChild(el);
      });
      document.getElementById('alertCount').innerText = alerts.length;

      // Smart assistant
      const assistant = document.getElementById('assistantText');
      const pastryRequests = {};
      orders.filter(o=>o.status!=='ready' && o.status!=='cancelled').forEach(o=>{
        o.items.forEach(it=>{ if(it.type==='Pastry'){ pastryRequests[it.name] = (pastryRequests[it.name]||0) + it.qty; } });
      });
      const pastryEntries = Object.entries(pastryRequests).sort((a,b)=>b[1]-a[1]);
      if(pastryEntries.length>0 && pastryEntries[0][1] >= 3) {
        assistant.innerText = `Consider prepping more ${pastryEntries[0][0]} — ${pastryEntries[0][1]} orders in queue`;
      } else if(alerts.some(a=>a.type==='long-wait')){
        assistant.innerText = 'Some orders are waiting too long — consider reallocating staff.';
      } else {
        assistant.innerText = 'No urgent suggestions.';
      }
    }

    // ----- Auto Refresh Simulator -----
    function setAutoRefresh(seconds){
      if(refreshTimer) { clearInterval(refreshTimer); refreshTimer = null; }
      if(seconds <= 0) return;
      refreshTimer = setInterval(()=>{
        // Each tick, advance some orders probabilistically.
        const speed = Number(document.getElementById('speedRange').value) || 1;
        // pick some orders to progress
        const candidates = orders.filter(o=>o.status==='waiting' || o.status==='in progress');
        const pickCount = Math.max(1, Math.floor(Math.sqrt(candidates.length) * speed));
        for(let i=0;i<pickCount;i++){
          const c = candidates[Math.floor(Math.random()*candidates.length)];
          if(!c) break;
          // with higher speed there's more chance to advance
          const p = Math.min(0.9, 0.2 * speed + Math.random());
          if(Math.random() < p) advanceOrder(c.id, false);
        }
        // Occasionally add a demo order
        if(Math.random() < 0.12 * speed) addRandomOrder();
        render();
      }, seconds*1000);
    }

    // ----- Utilities -----
    function timeTick(){ document.getElementById('localTime').innerText = new Date().toLocaleString(); }

    // ----- Event wiring -----
    document.getElementById('addDemoBtn').addEventListener('click', ()=>{ addRandomOrder(); });
    document.getElementById('add5DemoBtn').addEventListener('click', ()=>{ for(let i=0;i<5;i++) addRandomOrder(); });
    document.getElementById('clearOrdersBtn').addEventListener('click', ()=>{ clearCancelled(); });
    document.getElementById('refreshSelect').addEventListener('change', (e)=>{
      const val = Number(e.target.value);
      setAutoRefresh(val);
    });
    document.getElementById('speedRange').addEventListener('input', ()=>{ const val=Number(document.getElementById('refreshSelect').value); if(val>0){ setAutoRefresh(val); } });

    // seed some orders
    for(let i=0;i<6;i++) addRandomOrder();

    // initial render
    render();
    timeTick(); setInterval(timeTick, 1000);

    // Start default auto-refresh to off (0) by UI default. but pick 10s as recommended
    // (User can change)

    // expose some functions for debugging in devtools
    window._orders = orders;
    window.addRandomOrder = addRandomOrder;
    window.setAutoRefresh = setAutoRefresh;

    // Safety: ensure interval is properly cleared when page unloads
    window.addEventListener('beforeunload', ()=>{ if(refreshTimer) clearInterval(refreshTimer); });

    // Simple helper: compute a few example suggestions on load
    updateSummaryAndAlerts();

  </script>
</body>
</html>
